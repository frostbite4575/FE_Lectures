<nav class="breadcrumb">
  <a routerLink="/">Home</a>
  <span>/</span>
  <span>{{ club()?.name || "…" }}</span>
</nav>
@if (club()) {
<section class="panel hero">
  <div class="hero-row">
    <h2>{{ club()!.name }}</h2>
    @if (auth.isAdmin()) {
    <a class="btn btn-outline btn-hero" [routerLink]="['/clubs', id, 'edit']"
      >Edit club</a
    >
    }
  </div>
  <div class="badges stats">
    <span class="chip -info"
      >{{ club()!.members.length }}/{{ club()!.capacity }}</span
    >
    <span class="chip -primary">{{ percentFull(club()!) }}% full</span>
    <span
      class="chip"
      [class.-success]="seatsLeft(club()!) > 0"
      [class.-danger]="seatsLeft(club()!) === 0"
      >Seats left: {{ seatsLeft(club()!) }}</span
    >
  </div>
</section>

@if (auth.isAdmin()) {
<section class="panel members">
  <h3>Members</h3>
  <form (submit)="$event.preventDefault(); addMember()">
    <input
      placeholder="Member name"
      [value]="memberName()"
      (input)="memberName.set($any($event.target).value)"
    />
    <button type="submit">Add</button>
  </form>
  @if (memberMsg()) {
  <p class="status">{{ memberMsg() }}</p>
  }
  <ul class="list">
    <li class="header">
      <span>Member</span>
      <span>Actions</span>
    </li>
    @for (m of club()!.members; track m.id) {
    <li>
      <div class="left">{{ m.name }}</div>
      <div class="right">
        <button (click)="removeMember(m.id)">remove</button>
      </div>
    </li>
    }
  </ul>
</section>
}

<section class="panel events">
  <h3>Events</h3>
  <form (submit)="$event.preventDefault(); addEvent()">
    <input
      placeholder="Title"
      [value]="eventTitle()"
      (input)="eventTitle.set($any($event.target).value)"
    />
    <input
      type="date"
      [value]="eventDate()"
      (input)="eventDate.set($any($event.target).value)"
    />
    <input
      type="number"
      min="1"
      [value]="eventCapacity()"
      (input)="eventCapacity.set(+$any($event.target).value)"
    />
    <input
      placeholder="Description"
      [value]="eventDescription()"
      (input)="eventDescription.set($any($event.target).value)"
    />
    <button type="submit">Add</button>
  </form>
  @if (eventMsg()) {
  <p class="status">{{ eventMsg() }}</p>
  }
  <ul class="list">
    <li class="header">
      <span>Event</span>
      <span>Actions</span>
    </li>
    @for (e of club()!.events; track e.id) {
    <li>
      <div class="left">
        <strong>{{ e.title }}</strong>
        — {{ e.dateIso | friendlyDate }}
        <span class="chip -info">cap: {{ e.capacity }}</span>
        @if (e.description?.trim()) {
        <button
          type="button"
          class="icon-btn info"
          (click)="toggleEventDesc(e.id)"
          [attr.aria-expanded]="expandedEventId() === e.id"
          [attr.aria-controls]="'desc-' + e.id"
          title="Show description"
        >
          i
          <span class="sr-only">Show description</span>
        </button>
        }
      </div>
      <div class="right">
        @if (auth.isAdmin()) {
        <button (click)="removeEvent(e.id)">remove</button>
        }
      </div>
      @if (expandedEventId() === e.id) {
      <div class="desc" [attr.id]="'desc-' + e.id">
        {{ e.description }}
      </div>
      }
    </li>
    }
  </ul>
</section>
} @else {
<p>Loading…</p>
}
